version: 2

jobs:
  build:
    docker:
     - image: debian:stretch
    steps:
     - checkout
     - run: 'apt-get update && apt-get install -y sudo gcc g++ cmake lcov curl'
     - run: 'cmake -H. -Bbuild && cmake --build build'
     - store_artifacts: 
         path: build/ci
         destination: ci
     - codecov/upload:
         file: build/ci
     - run: 'bash <(curl -s https://codecov.io/bash) | sed -E "s/token=[A-Fa-f0-9\-]+/token=[codecov token]/g" | sed -e "s/$CODECOV_TOKEN/[codecov token]/g"'
